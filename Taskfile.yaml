version: "3"

tasks:
  
  run:
    desc: "Run main application"
    cmd: go run ./cmd/sso --config=./config/local.yaml

  dev:
    desc: "Run main application with hot reload"
    cmd: task :start -w

  migrate:
    desc: "migrate DB"
    cmd: go run ./cmd/migrator --storage-path=./storage/sso.db --migrations-path=./migrations

  test:
    desc: "Tests app"
    cmd: go test -v ./tests

  migrate-test:
    desc: "migrate test DB"
    cmd: go run ./cmd/migrator --storage-path=./storage/sso.db --migrations-path=./tests/migrations --migrations-table=migrations_test

  init:
    desc: "Init developers instruments"
    # cmd: go install github.com/cortesi/modd/cmd/modd@latest
    # cmd: go install github.com/jdudmesh/gomon@latest

  :build:
    cmds:
      - 'go build -o bin/main ./cmd/sso/main.go'
    sources:
      - ./*.go,
      - ./**/*.go

  :start:
    cmds:
      - task: :build
      - './bin/main --config=./config/local.yaml'
    sources: 
      - ./*.go,
      - ./**/*.go